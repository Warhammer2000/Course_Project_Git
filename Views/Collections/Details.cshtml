@using System.Security.Claims
@using CourseProjectItems.Data
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model CourseProjectItems.ViewModels.CollectionViewModel
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
	ViewData["Title"] = Localizer["Collection Details"];
}

<h2>@Localizer["Collection Details"] <i class="fas fa-info-circle"></i></h2>

<div>
	<p>
		<strong>@Localizer["Created by"]:</strong>
		<span class="badge badge-info">
			<i class="fas fa-user"></i> @(Model.AuthorUserName == null ? "Admin" : Model.AuthorUserName)
		</span>
	</p>
	<h4>@Model.Name</h4>
	<hr />
	<dl class="row">
		<dt class="col-sm-2">@Localizer["Description"] <i class="fas fa-align-left"></i></dt>
		<dd class="col-sm-10">@Model.Description</dd>
		<dt class="col-sm-2">@Localizer["Category"] <i class="fas fa-list-alt"></i></dt>
		<dd class="col-sm-10">@Model.Category</dd>
	</dl>
</div>
<div>
	<h4>@Localizer["Items"] <i class="fas fa-th-list"></i></h4>
	<table class="table">
		<thead>
			<tr>
				<th>@Localizer["Photo"] <i class="fas fa-image"></i></th>
				<th>@Localizer["Name"] <i class="fas fa-font"></i></th>
				<th>@Localizer["Tags"] <i class="fas fa-tags"></i></th>
				<th>@Localizer["Additional Fields"] <i class="fas fa-plus"></i></th>
				<p>
					<strong>@Localizer["Created by"]:</strong>
					<span class="badge badge-info">
						<i class="fas fa-user"></i> @(Model.AuthorUserName == null ? "Admin" : Model.AuthorUserName)
					</span>
				</p>
				<th>@Localizer["Actions"] <i class="fas fa-cogs"></i></th>
			</tr>
		</thead>
		<tbody>
			@foreach (var item in Model.Items)
			{
				<tr>
					<td>
						@if (!string.IsNullOrEmpty(item.PhotoUrl))
						{
							<p>
								<a href="@Model.PhotoUrl" target="_blank">@Localizer["Photo URL"]: @Model.PhotoUrl <i class="fas fa-link"></i></a>
							</p>
							<img src="@Url.Content(item.PhotoUrl)" alt="@Localizer["Item Photo"]" width="250" height="250" />
						}
						else
						{
							<img src="@Url.Content("~/images/Item(Proj).png")" alt="@Localizer["Item Photo"]" width="250" height="250">
						}
					</td>
					<td>@item.Name</td>
					<td>@item.Tags</td>
					<td>
						@if (!string.IsNullOrEmpty(item.AdditionalFields))
						{
							@foreach (var field in item.AdditionalFields.Split(';'))
							{
								<p>@field</p>
							}
						}
						else
						{
							<p>@Localizer["No additional fields"] <i class="fas fa-exclamation-circle"></i></p>
						}
					</td>
					<td>
						<a asp-action="Details" asp-controller="Items" asp-route-id="@item.Id" class="btn btn-secondary">@Localizer["Details"] <i class="fas fa-eye"></i></a>
						@if (User.IsInRole(UserRoles.Admin) || User.FindFirstValue(ClaimTypes.NameIdentifier) == Model.AuthorId)
						{
							<a asp-action="Edit" asp-controller="Items" asp-route-id="@item.Id" class="btn btn-info">@Localizer["Edit"] <i class="fas fa-edit"></i></a>
							<a asp-action="Delete" asp-controller="Items" asp-route-id="@item.Id" class="btn btn-danger">@Localizer["Delete"] <i class="fas fa-trash-alt"></i></a>
						}
					</td>
				</tr>
			}
		</tbody>
	</table>
</div>

<div>
	@if (User.IsInRole(UserRoles.Admin) || User.FindFirstValue(ClaimTypes.NameIdentifier) == Model.AuthorId)
	{
		<a asp-action="CreateItem" asp-route-collectionId="@Model.Id" class="btn btn-primary">@Localizer["Add New Item"] <i class="fas fa-plus"></i></a>
		<a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-info">@Localizer["Edit"] <i class="fas fa-edit"></i></a>
	}
	<a asp-action="Index" class="btn btn-secondary">@Localizer["Back to List"] <i class="fas fa-arrow-left"></i></a>
	<a asp-action="ExportToCsv" asp-route-id="@Model.Id" class="btn btn-primary btn-sm m-1">
		<i class="fas fa-file-csv"></i> @Localizer["Export to CSV"]
	</a>
</div>

<style>
	.table img {
		width: 250px;
		height: auto;
		object-fit: cover;
	}

	.badge-info {
		background-color: #17a2b8;
		color: white;
		padding: 0.5em 0.75em;
		font-size: 1em;
		border-radius: 0.25rem;
	}

		.badge-info i {
			margin-right: 0.25em;
		}
</style>

@section Scripts {
	@{
		await Html.RenderPartialAsync("_ValidationScriptsPartial");
	}
}
