@using System.Security.Claims
@using CourseProjectItems.Data
@using Microsoft.AspNetCore.Mvc.TagHelpers
@model IEnumerable<CourseProjectItems.ViewModels.CollectionViewModel>
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer Localizer
@{
    ViewData["Title"] = Localizer["Collections"];
}

<h1>@Localizer["Collections"] <i class="fas fa-th-large"></i></h1>

@if (User.IsInRole(UserRoles.Admin) || Model.Any(item => item.AuthorId == User.FindFirstValue(ClaimTypes.NameIdentifier)))
{
    <p>
        <a asp-action="Create" class="btn btn-primary">
            <i class="fas fa-plus-circle"></i> @Localizer["Create New"]
        </a>
    </p>
}
@if (Model.Any())
{
    <table class="table table-bordered table-striped table-hover">
        <thead class="thead-dark">
            <tr>
                <th>@Localizer["Name"] <i class="fas fa-font"></i></th>
                <th>@Localizer["Description"] <i class="fas fa-align-left"></i></th>
                <th>@Localizer["Category"] <i class="fas fa-tags"></i></th>
                <th>@Localizer["Type"] <i class="fas fa-list-alt"></i></th>
                <th>@Localizer["Icon"] <i class="fas fa-icons"></i></th>
                <th>@Localizer["Created by"] <i class="fas fa-user"></i></th>
                <th>@Localizer["Actions"] <i class="fas fa-cogs"></i></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => item.Name)</td>
                    <td>@Html.DisplayFor(modelItem => item.Description)</td>
                    <td>@Html.DisplayFor(modelItem => item.Category)</td>
                    <td>@Html.DisplayFor(modelItem => item.Type)</td>
                    <td><i class="@item.IconClass"></i></td>
                    <td>
                        <span class="badge badge-info">
                            <i class="fas fa-user"></i> @(item.AuthorUserName == null ? "Admin" : item.AuthorUserName)
                        </span>
                    </td>
                    <td>
                        <div class="d-flex flex-wrap">
                            <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-info btn-sm m-1">
                                <i class="fas fa-eye"></i> @Localizer["Details"]
                            </a>
                            <a asp-action="ExportToCsv" asp-route-id="@item.Id" class="btn btn-primary btn-sm m-1">
                                <i class="fas fa-file-csv"></i> @Localizer["Export to CSV"]
                            </a>
                            @if (User.FindFirstValue(ClaimTypes.NameIdentifier) == item.AuthorId || User.IsInRole(UserRoles.Admin))
                            {
                                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-secondary btn-sm m-1">
                                    <i class="fas fa-edit"></i> @Localizer["Edit"]
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-sm m-1">
                                    <i class="fas fa-trash"></i> @Localizer["Delete"]
                                </a>
                            }
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>@Localizer["No collections found."] <i class="fas fa-exclamation-circle"></i></p>
}

<p class="text-info">@Localizer["Current Language:"] @Thread.CurrentThread.CurrentCulture.DisplayName <i class="fas fa-language"></i></p>

<style>
    .badge-info {
        background-color: #17a2b8;
        color: white;
        padding: 0.5em 0.75em;
        font-size: 1em;
        border-radius: 0.25rem;
    }

        .badge-info i {
            margin-right: 0.25em;
        }

    .table th, .table td {
        vertical-align: middle;
    }

    .btn-sm {
        margin-right: 5px;
    }

    .alert {
        margin-top: 20px;
    }

    .table td i {
        margin-left: 5px;
    }

    .popover {
        max-width: 300px;
    }
</style>

@section Scripts {
    <script>
        $(document).ready(function () {
            $('[data-toggle="popover"]').popover({
                trigger: 'hover',
                placement: 'top',
                html: true
            });
        });
    </script>
}
